local u=game:GetService("UserInputService")
local r=game:GetService("RunService")
local sg=Instance.new("ScreenGui",game:GetService("CoreGui"))
sg.IgnoreGuiInset=true
sg.ResetOnSpawn=false
sg.ZIndexBehavior=Enum.ZIndexBehavior.Sibling

local g={}
local windows = {}

function g.newWindow(title)
    local w=Instance.new("Frame",sg)
    w.BackgroundColor3=Color3.fromRGB(30,30,30)
    w.BorderSizePixel=0
    w.Size=UDim2.new(0,300,0,40)
    w.Position=UDim2.new(0,10 + (#windows)*(310),0,50)
    w.ClipsDescendants=true
    w.ZIndex = 100

    local header=Instance.new("TextButton",w)
    header.Text=title
    header.Font=Enum.Font.SourceSansBold
    header.TextSize=22
    header.TextColor3=Color3.new(1,1,1)
    header.BackgroundColor3=Color3.fromRGB(50,50,50)
    header.Size=UDim2.new(1,0,0,40)
    header.AutoButtonColor=false

    local content=Instance.new("Frame",w)
    content.BackgroundColor3=Color3.fromRGB(40,40,40)
    content.Size=UDim2.new(1,0,0,0)
    content.Position=UDim2.new(0,0,0,40)
    content.Visible=false

    local layout=Instance.new("UIListLayout",content)
    layout.Padding=UDim.new(0,5)
    layout.SortOrder=Enum.SortOrder.LayoutOrder

    local expanded = false

    local function toggle()
        expanded = not expanded
        if expanded then
            content.Visible=true
            content.Size=UDim2.new(1,0,0,layout.AbsoluteContentSize.Y)
            w.Size=UDim2.new(0,300,0,40 + layout.AbsoluteContentSize.Y)
        else
            content.Visible=false
            content.Size=UDim2.new(1,0,0,0)
            w.Size=UDim2.new(0,300,0,40)
        end
    end

    header.MouseButton1Click:Connect(toggle)

    r.Heartbeat:Connect(function()
        if expanded then
            content.Size=UDim2.new(1,0,0,layout.AbsoluteContentSize.Y)
            w.Size=UDim2.new(0,300,0,40 + layout.AbsoluteContentSize.Y)
        end
    end)

    local api = {}

    function api.addButton(text, callback)
        local btn = Instance.new("TextButton", content)
        btn.Text = text
        btn.Size = UDim2.new(1, -10, 0, 30)
        btn.Position = UDim2.new(0, 5, 0, 0)
        btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.SourceSans
        btn.TextSize = 18
        btn.AutoButtonColor = false
        btn.MouseButton1Click:Connect(callback)
        return btn
    end

    function api.addToggle(text, callback)
        local state = false
        local btn = Instance.new("TextButton", content)
        btn.Text = text .. ": OFF"
        btn.Size = UDim2.new(1, -10, 0, 30)
        btn.Position = UDim2.new(0, 5, 0, 0)
        btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.SourceSans
        btn.TextSize = 18
        btn.AutoButtonColor = false
        btn.MouseButton1Click:Connect(function()
            state = not state
            btn.Text = text .. (state and ": ON" or ": OFF")
            callback(state)
        end)
        return btn
    end

    api._frame = w
    windows[#windows+1] = w

    return api
end

return g
